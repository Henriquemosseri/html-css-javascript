<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atividade 1</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <header>
        <h1>Bem-vindo ao site</h1>
    </header>
    <nav>
        <a href="">link 1</a>
        <a href="">link 2</a>
        <a href="">link 3</a>
    </nav>


    <main id="main">
        <section id="section1">
            <h2 class="subtitulo">Lorem ipsum dolor sit amet consectetur,</h2>
            <p id="paragrafo">Lorem ipsum dolor sit amet consectetur adipisicing elit. Porro exercitationem omnis minus
                obcaecati natus veniam libero perspiciatis quibusdam maxime culpa sed rem aliquam fugit, ut repellendus
                aliquid! Doloremque nemo minima quia labore, dolore expedita itaque quo doloribus, hic totam laboriosam
                id, ratione error adipisci cupiditate neque placeat laborum molestiae nihil!</p>
            <button onclick="mudarCor()" class="botoes"><b> mudar cor</b></button>
            <br>

            <label for="item-lista">Insira na lista abaixo <input type="text" name="item-lista" id="item-lista"></label>
            <button onclick="criarLista()" class="botoes">criar lista</button>
            <ul id="lista">
            </ul>
        </section>
        <div>
            <p id="testeAPI"></p>

            <form id="cadastroForm">
                <label for="">Digite seu nome: <input type="text" id="nome" required></label>
                <label for="">Digite seu email: <input type="text" id="email" required></label>
                <button type="submit" class="botoes">enviar</button>
            </form>
        </div>

        <label for="filtro">Filtrar por preço:</label>
        <select id="filtro" onchange="filtrarProdutos()">
            <option value="todos">Todos</option>
            <option value="menor1000">Menores que R$ 1000</option>
        </select>
        <table>
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Marca</th>
                    <th>Preço</th>
                </tr>
            </thead>
            <tbody id="tabela-produtos">
            </tbody>
        </table>
        <button class="botoes" onclick="buscarProdutos()">Carregar Produtos</button>
    </main>

    <footer id="footer">
        <p>Autor: Henrique Mosseri</p>
        <p> 2025</p>
    </footer>

</body>
<script>
    removerItemLista();
    testeFetch();
    const API_URL = "http://demo8131881.mockable.io/cadastro";

    document.getElementById("cadastroForm").addEventListener("submit", function (event) {
        event.preventDefault();
        enviarDados();
    });

    function capturarDados() {
        return {
            nome: document.getElementById("nome").value,
            email: document.getElementById("email").value
        };
    }

    async function enviarDados() {
        const dados = capturarDados();

        try {
            const response = await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dados)
            });

            const data = await response.json();
            mostrarResposta(data);
        } catch (error) {
            console.error("Erro ao enviar dados:", error);
        }
    }

    function mostrarResposta(data) {
        alert(data.msg);
        console.log("Resposta do servidor:", data);
    }


    function mudarCor() {
        let textElement = document.getElementById("paragrafo");
        textElement.style.color = "red";
    }

    function criarLista() {
        let itemLista = document.getElementById("item-lista").value;
        var item = document.createElement("li");
        item.append(itemLista);
        document.getElementById("lista").append(item);
    }
    function removerItemLista() {
        document.getElementById("lista").addEventListener("dblclick", function (event) {
            if (event.target.tagName === "LI") {
                event.target.remove();
            }
        });
    }

    function testeFetch() {
        fetch("http://demo8131881.mockable.io/teste")
            .then(response => response.json())
            .then(data => mostrarDado(data))
            .catch(error => console.log(error))
    }

    function mostrarDado(data) {
        document.getElementById("testeAPI").innerText = data.msg;
    }

    let listaCompleta = [];

    function buscarProdutos() {
        fetch("http://demo8131881.mockable.io/produtos")
            .then(response => response.json())
            .then(data => {
            listaCompleta = data;
            filtrarProdutos();
        })
            .catch(error => console.error("Erro ao buscar os produtos:", error));
    }

    function preencherTabela(listaProdutos) {
        const tbody = document.getElementById("tabela-produtos");
        tbody.innerHTML = "";

        for (let i = 0; i < listaProdutos.length; i++) {
            let produto = listaProdutos[i];

            let linha = document.createElement("tr");
            linha.innerHTML = `
            <td>${produto.nome}</td>
            <td>${produto.marca}</td>
            <td>R$ ${produto.preco.toFixed(2)}</td>
        `;

            tbody.appendChild(linha);
        }
    }

    function filtrarProdutos() {
        const filtro = document.getElementById("filtro").value;

        if (filtro === "menor1000") {
            const listaFiltrada = listaCompleta.filter(produto => produto.preco < 1000);
            preencherTabela(listaFiltrada);
        } else {
            preencherTabela(listaCompleta);
        }
    }
</script>

</html>